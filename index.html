<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>KI-Hub - Einfach & Funktionell</title>
  
  <!-- PWA Manifest & Theme -->
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#764ba2">
  <link rel="apple-touch-icon" href="icon-192x192.png">

  <style>
    :root {
      --bg-grad-start: #667eea;
      --bg-grad-end: #764ba2;
      --text-light: #ffffff;
      --text-dark: #333;
      --section-bg: rgba(255, 255, 255, 0.95);
      --section-h2: #555;
      --status-bg: #e3f2fd;
      --status-border: #2196F3;
      --status-text: #333;
    }

    body.dark-mode {
      --bg-grad-start: #2c3e50;
      --bg-grad-end: #4b6cb7;
      --text-light: #f0f0f0;
      --text-dark: #f0f0f0;
      --section-bg: rgba(45, 52, 71, 0.95);
      --section-h2: #e0e0e0;
      --status-bg: #3a476a;
      --status-border: #5c6bc0;
      --status-text: #f0f0f0;
    }

    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
      color: var(--text-dark);
      text-align: center;
      padding: 20px;
      min-height: 100vh;
      margin: 0;
      transition: background 0.3s, color 0.3s;
    }
    
    .container {
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .header-container {
      display: flex;
      justify-content: center;
      align-items: center;
      position: relative;
    }
    
    h1 {
      color: var(--text-light);
      margin: 0 auto;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
      font-size: 2.5em;
    }

    .theme-switch-wrapper {
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      align-items: center;
      flex-direction: column;
      color: var(--text-light);
      font-size: 12px;
    }
    .theme-switch {
      position: relative;
      display: inline-block;
      width: 50px;
      height: 24px;
      margin-bottom: 4px;
    }
    .theme-switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      transition: .4s;
      border-radius: 24px;
    }
    .slider:before {
      position: absolute;
      content: "";
      height: 18px;
      width: 18px;
      left: 3px;
      bottom: 3px;
      background-color: white;
      transition: .4s;
      border-radius: 50%;
    }
    input:checked + .slider {
      background-color: #2196F3;
    }
    input:checked + .slider:before {
      transform: translateX(26px);
    }
    
    #installBtn {
        margin: 20px auto 20px;
        padding: 12px 24px;
        font-size: 16px;
        font-weight: bold;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        color: white;
        background-color: #4CAF50;
        box-shadow: 0 0 15px #4CAF50, 0 0 25px #4CAF50;
        animation: glow 1.5s infinite alternate;
        display: none; /* Wird per JS angezeigt */
    }

    @keyframes glow {
        from { box-shadow: 0 0 10px #4CAF50, 0 0 20px #4CAF50; }
        to { box-shadow: 0 0 20px #5cb85c, 0 0 30px #5cb85c; }
    }
    
    .section {
      margin: 20px 0;
      padding: 20px;
      background: var(--section-bg);
      border-radius: 15px;
      box-shadow: 0 8px 25px rgba(0,0,0,0.15);
      transition: background 0.3s;
    }
    
    .section h2 {
      color: var(--section-h2);
      margin-bottom: 20px;
      transition: color 0.3s;
    }
    
    button {
      margin: 8px;
      padding: 12px 24px;
      font-size: 16px;
      font-weight: bold;
      cursor: pointer;
      border: none;
      border-radius: 8px;
      color: white;
      transition: all 0.2s;
      min-width: 150px;
      line-height: 1.3;
    }
    
    button small {
      display: block;
      font-size: 12px;
      font-weight: normal;
      opacity: 0.9;
      margin-top: 3px;
    }
    
    .text-ai { background: #4CAF50; }
    .text-ai:hover { background: #45a049; transform: scale(1.05); }
    
    .image-ai { background: #2196F3; }
    .image-ai:hover { background: #0b7dda; transform: scale(1.05); }
    
    .control-btn { background: #ff9800; }
    .control-btn:hover { background: #e68900; }
    
    #status {
      margin: 15px 0;
      padding: 15px;
      font-size: 16px;
      background: var(--status-bg);
      border: 2px solid var(--status-border);
      color: var(--status-text);
      border-radius: 8px;
      font-weight: bold;
      transition: background 0.3s, border-color 0.3s, color 0.3s;
    }
    
    #micBtn {
      font-size: 30px;
      width: 80px;
      height: 80px;
      border-radius: 50%;
      margin: 10px auto;
      display: block;
    }
    
    .listening {
      background: #f44336 !important;
      animation: pulse 1s infinite;
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.1); }
      100% { transform: scale(1); }
    }
    
    .button-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }
    
    .debug {
      background: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 5px;
      padding: 10px;
      margin: 10px 0;
      font-family: monospace;
      font-size: 12px;
      text-align: left;
      display: none;
    }

    /* Gemini Feature Styles */
    .gemini-result-container {
        margin-top: 20px;
        padding: 20px;
        background: var(--status-bg);
        border: 1px solid var(--status-border);
        border-radius: 8px;
        min-height: 100px;
        text-align: left;
        line-height: 1.6;
        display: none; /* Initially hidden */
        white-space: pre-wrap; /* To respect newlines from the API response */
        color: var(--status-text);
        transition: background 0.3s, border-color 0.3s, color 0.3s;
    }

    .loader {
        border: 5px solid #f3f3f3;
        border-top: 5px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 20px auto;
    }

    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header-container">
        <h1>ü§ñ Mein KI-Hub</h1>
        <div class="theme-switch-wrapper">
            <label class="theme-switch" for="checkbox">
                <input type="checkbox" id="checkbox" />
                <div class="slider round"></div>
            </label>
            <span>Nachtmodus</span>
        </div>
    </div>
    
    <button id="installBtn">App installieren</button>

    <div class="section">
      <h2>üé§ Sprachsteuerung</h2>
      <button id="micBtn" class="control-btn">üé§</button>
      <div id="status">Klicke auf das Mikrofon f√ºr Sprachsteuerung</div>
      <div id="debug" class="debug"></div>
    </div>
    
    <div class="section">
        <h2>‚ú® KI des Tages</h2>
        <p style="color: var(--section-h2);">Brauchst du eine Idee? Lass dir von mir eine zuf√§llige, kreative Aufgabe vorschlagen!</p>
        <button id="geminiBtn" class="control-btn" style="background: linear-gradient(135deg, #ab68e6 0%, #7d5ab5 100%); min-width: 250px;">Vorschlag generieren</button>
        <div id="geminiResult" class="gemini-result-container">
            <!-- Loading spinner and result will go here -->
        </div>
    </div>

    <div class="section">
      <h2>üí¨ Text-KIs</h2>
      <div class="button-grid">
        <button class="text-ai" data-url="https://chat.openai.com/">ChatGPT <small>(Chat)</small></button>
        <button class="text-ai" data-url="https://claude.ai/">Claude <small>(Claudia)</small></button>
        <button class="text-ai" data-url="https://www.perplexity.ai/">Perplexity <small>(Plexi)</small></button>
        <button class="text-ai" data-url="https://gemini.google.com/">Gemini <small>(Zwilling, Google)</small></button>
        <button class="text-ai" data-url="https://copilot.microsoft.com/">Microsoft Copilot <small>(Mitfahrer)</small></button>
        <button class="text-ai" data-url="https://aistudio.google.com/prompts/new_chat">Google AI Studio <small>(Ei, Studio)</small></button>
        <button class="text-ai" data-url="https://www.manus.ai/">Manus <small>(Schreiber)</small></button>
        <button class="text-ai" data-url="https://www.lechat.ai/">Le Chat <small>(Franzose, Richard)</small></button>
        <button class="text-ai" data-url="https://deepseek.ai/">DeepSeek <small>(Chinese)</small></button>
        <button class="text-ai" data-url="https://grok.com/">Grok <small>(X-Man)</small></button>
      </div>
    </div>

    <div class="section">
      <h2>üé® Bild-KIs</h2>
      <div class="button-grid">
        <button class="image-ai" data-url="https://app.leonardo.ai/">Leonardo AI <small>(Lenni, Lenny)</small></button>
        <button class="image-ai" data-url="https://cgdream.ai/">CGDream <small>(Dreamer, Tr√§umer)</small></button>
        <button class="image-ai" data-url="https://ideogram.ai/t/explore">Ideogram <small>(Idiota)</small></button>
        <button class="image-ai" data-url="https://preview.reve.art/app">Reve <small>(Rewe, franz. Traum)</small></button>
        <button class="image-ai" data-url="https://creator.nightcafe.studio/">NightCafe <small>(Sp√§ti, Nachtcafe)</small></button>
        <button class="image-ai" data-url="https://qwen.ai/">Qwen <small>(Queen, chin. K√∂nigin, Wenn)</small></button>
        <button class="image-ai" data-url="https://arena.lmsys.org/">LM Arena <small>(Arena)</small></button>
        <button class="image-ai" data-url="https://huggingface.co/spaces">HuggingFace <small>(Gesicht)</small></button>
        <button class="image-ai" data-url="https://nanobanana.ai/">Nano Banana <small>(Banane)</small></button>
        <button class="image-ai" data-url="https://openart.ai/home">Open Art <small>(Kunst, Art AI)</small></button>
      </div>
    </div>
  </div>

  <script>
    // ===========================================
    // PWA & SERVICE WORKER LOGIK
    // ===========================================
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(reg => console.log('SW registriert')).catch(err => console.log('SW Fehler', err));
      });
    }

    let deferredPrompt;
    const installBtn = document.getElementById('installBtn');
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
      installBtn.style.display = 'block';
    });
    
    installBtn.addEventListener('click', (e) => {
      installBtn.style.display = 'none';
      deferredPrompt.prompt();
      deferredPrompt.userChoice.then((choiceResult) => {
        console.log(choiceResult.outcome === 'accepted' ? 'App installiert' : 'Installation abgelehnt');
        deferredPrompt = null;
      });
    });

    if (window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone) {
      installBtn.style.display = 'none';
    }

    // ===========================================
    // GLOBALE VARIABLEN
    // ===========================================
    let recognition = null;
    let isListening = false;
    let debugMode = false;

    // ===========================================
    // ERWEITERTE KI-DEFINITIONEN MIT DEUTSCHEN BEGRIFFEN
    // ===========================================
    const kiList = {
      'chatgpt': { url: 'https://chat.openai.com/', names: ['chatgpt', 'chat gpt', 'chat', 'gpt', 'openai', 'chegti', 'tschett'] },
      'claude': { url: 'https://claude.ai/', names: ['claude', 'claudia', 'klaud', 'klaude', 'cloud', 'claud'] },
      'perplexity': { url: 'https://www.perplexity.ai/', names: ['perplexity', 'plexi', 'perp', 'suche', 'perplex', 'komplexit√§t'] },
      'gemini': { url: 'https://gemini.google.com/', names: ['gemini', 'zwilling', 'zwillinge', 'google', 'gugel', 'dschemini', 'den zwilling'] },
      'copilot': { url: 'https://copilot.microsoft.com/', names: ['copilot', 'mitfahrer', 'pilot', 'microsoft', 'den mitfahrer', 'kopilot'] },
      'aistudio': { url: 'https://aistudio.google.com/prompts/new_chat', names: ['google ai studio', 'ai studio', 'studio', 'ei'] },
      'manus': { url: 'https://www.manus.ai/', names: ['manus', 'schreiber', 'text', 'schreiben', 'den schreiber', 'hand'] },
      'lechat': { url: 'https://www.lechat.ai/', names: ['le chat', 'franzose', 'den franzose', 'franz√∂sisch', 'lechat', 'richard'] },
      'deepseek': { url: 'https://deepseek.ai/', names: ['deepseek', 'chinese', 'chinesen', 'den chinesen', 'den chinese', 'china', 'deep', 'seek'] },
      'grok': { url: 'https://grok.com/', names: ['grok', 'x-man', 'xmen', 'x men', 'elon', 'twitter', 'x', 'grog'] },
      'leonardo': { url: 'https://app.leonardo.ai/', names: ['leonardo', 'lenni', 'lenny', 'leo', 'bild', 'bilder', 'k√ºnstler', 'da vinci'] },
      'cgdream': { url: 'https://cgdream.ai/', names: ['cgdream', 'dreamer', 'tr√§umer', 'den tr√§umer', 'dream', 'traum', 'cg'] },
      'ideogram': { url: 'https://ideogram.ai/t/explore', names: ['ideogram', 'idiota'] },
      'reve': { url: 'https://preview.reve.art/app', names: ['reve', 'rewe', 'franz√∂sischen traum', 'den franz√∂sischen traum', 'rev', 'franz√∂sisch traum'] },
      'nightcafe': { url: 'https://creator.nightcafe.studio/', names: ['nightcafe', 'sp√§ti', 'nachtcafe', 'nacht cafe', 'kaffee', 'den sp√§ti', 'night'] },
      'qwen': { url: 'https://qwen.ai/', names: ['qwen', 'queen', 'k√∂nigin', 'chinesische k√∂nigin', 'die chinesische k√∂nigin', 'die k√∂nigin', 'kwen', 'wenn'] },
      'arena': { url: 'https://arena.lmsys.org/', names: ['arena', 'die arena', 'lm arena', 'kampf', 'vergleich'] },
      'huggingface': { url: 'https://huggingface.co/spaces', names: ['huggingface', 'gesicht', 'das gesicht', 'hugging', 'umarmung', 'hug'] },
      'nanobanana': { url: 'https://nanobanana.ai/', names: ['nano banana', 'banane', 'die banane', 'banana', 'nano', 'nana'] },
      'openart': { url: 'https://openart.ai/home', names: ['open art', 'art ai', 'artai', 'kunst', 'k√ºnstler', 'art', 'maler'] }
    };

    // ===========================================
    // HELPER FUNKTIONEN
    // ===========================================
    function debugLog(message) {
      console.log('üõ† DEBUG:', message);
      if (debugMode) {
        const debugDiv = document.getElementById('debug');
        debugDiv.style.display = 'block';
        debugDiv.innerHTML += new Date().toLocaleTimeString() + ': ' + message + '<br>';
        debugDiv.scrollTop = debugDiv.scrollHeight;
      }
    }

    function updateStatus(message) {
      document.getElementById('status').textContent = message;
      debugLog('Status: ' + message);
    }

    // ===========================================
    // KI √ñFFNEN FUNKTION
    // ===========================================
    function openKI(url) {
      debugLog('Versuche zu √∂ffnen: ' + url);
      try {
        const newWindow = window.open(url, '_blank', 'noopener,noreferrer');
        if (!newWindow) {
          updateStatus('‚ùå Popup blockiert! Erlaube Popups f√ºr diese Seite');
        }
      } catch (error) {
        updateStatus('‚ùå Fehler beim √ñffnen der URL');
      }
    }

    // ===========================================
    // SPRACHSTEUERUNG
    // ===========================================
    function toggleListening() {
      if (isListening) {
        stopListening();
      } else {
        startListening();
      }
    }

    function startListening() {
      if (!window.webkitSpeechRecognition && !window.SpeechRecognition) {
        updateStatus('‚ùå Spracherkennung nicht unterst√ºtzt');
        return;
      }
      try {
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();
        recognition.lang = 'de-DE';
        recognition.continuous = false;
        recognition.interimResults = false;
        
        recognition.onstart = () => {
          isListening = true;
          document.getElementById('micBtn').classList.add('listening');
          document.getElementById('micBtn').textContent = 'üõë';
          updateStatus('üé§ Ich h√∂re...');
        };
        
        recognition.onresult = (event) => {
          const transcript = event.results[0][0].transcript.toLowerCase().trim();
          updateStatus('Erkannt: "' + transcript + '"');
          processVoiceCommand(transcript);
        };
        
        recognition.onerror = (event) => {
          updateStatus('‚ùå Sprachfehler: ' + event.error);
          stopListening();
        };
        
        recognition.onend = () => stopListening();
        
        recognition.start();
      } catch (error) {
        updateStatus('‚ùå Sprachfehler: ' + error.message);
      }
    }

    function stopListening() {
      isListening = false;
      if (recognition) recognition.stop();
      document.getElementById('micBtn').classList.remove('listening');
      document.getElementById('micBtn').textContent = 'üé§';
    }

    function processVoiceCommand(transcript) {
      let found = false;
      for (const kiId in kiList) {
        if (kiList[kiId].names.some(name => transcript.includes(name))) {
          updateStatus('‚úÖ √ñffne ' + kiId.toUpperCase());
          openKI(kiList[kiId].url);
          found = true;
          break;
        }
      }
      if (!found) {
        updateStatus('‚ùå Nicht verstanden: "' + transcript + '"');
      }
    }

    // ===========================================
    // GEMINI API FEATURE: KI DES TAGES
    // ===========================================
    async function getAIDaySuggestion() {
        const geminiResultDiv = document.getElementById('geminiResult');
        geminiResultDiv.style.display = 'block';
        geminiResultDiv.innerHTML = '<div class="loader"></div>';

        const aiButtons = document.querySelectorAll('.text-ai, .image-ai');
        const aiNames = Array.from(aiButtons).map(btn => btn.innerText.split('<small>')[0].trim());

        const systemPrompt = `Du bist ein KI-Experte und kreativer Berater. Hier ist eine Liste von KI-Tools: ${aiNames.join(', ')}. W√§hle EINES dieser Tools aus. Schreibe dann eine kurze, inspirierende Empfehlung f√ºr eine kreative oder produktive Aufgabe, die man heute damit ausprobieren k√∂nnte. Gib den Namen des Tools fett formatiert (**Toolname:**) an und erkl√§re die Aufgabe in einem einzigen, ansprechenden Absatz. Antworte auf Deutsch.`;
        const userQuery = "Gib mir eine Empfehlung f√ºr heute.";

        const apiKey = ""; // Wird von der Canvas-Umgebung bereitgestellt
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        const payload = {
            contents: [{ parts: [{ text: userQuery }] }],
            systemInstruction: {
                parts: [{ text: systemPrompt }]
            },
        };

        try {
            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API-Fehler: ${response.status}`);
            }

            const result = await response.json();
            const candidate = result.candidates?.[0];

            if (candidate && candidate.content?.parts?.[0]?.text) {
                let text = candidate.content.parts[0].text;
                // Sanitize and format the text
                text = text.replace(/</g, "&lt;").replace(/>/g, "&gt;"); // Basic sanitization
                text = text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // Convert markdown bold to HTML bold
                geminiResultDiv.innerHTML = text;
            } else {
                geminiResultDiv.innerText = 'Entschuldigung, es konnte kein Vorschlag generiert werden. Versuche es sp√§ter erneut.';
                console.error('Ung√ºltige API-Antwort:', result);
            }

        } catch (error) {
            console.error('Fehler bei der Gemini API-Anfrage:', error);
            geminiResultDiv.innerText = 'Ein Fehler ist aufgetreten. Bitte √ºberpr√ºfe die Konsole f√ºr Details.';
        }
    }


    // ===========================================
    // INITIALISIERUNG
    // ===========================================
    document.addEventListener('DOMContentLoaded', function() {
      // Button-Handler einrichten
      document.querySelectorAll('button[data-url]').forEach(button => {
        button.addEventListener('click', () => openKI(button.getAttribute('data-url')));
      });
      
      // Mikrofon-Button
      document.getElementById('micBtn').addEventListener('click', toggleListening);
      
      // Gemini-Button
      document.getElementById('geminiBtn').addEventListener('click', getAIDaySuggestion);
      
      // Nachtmodus-Schalter
      const themeSwitch = document.getElementById('checkbox');
      themeSwitch.addEventListener('change', () => {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('theme', document.body.classList.contains('dark-mode') ? 'dark' : 'light');
      });

      // Gespeichertes Theme laden
      if (localStorage.getItem('theme') === 'dark') {
          document.body.classList.add('dark-mode');
          themeSwitch.checked = true;
      }

      updateStatus('‚úÖ Alles bereit!');
    });

  </script>
</body>
</html>
